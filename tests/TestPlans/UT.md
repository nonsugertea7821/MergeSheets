\# 試験要領書 - Excelシート統合マクロ

\## 1. 試験目的

本マクロが設計仕様どおりに動作し、統合元フォルダ内のExcelシートを正しく統合先ブックにコピーできることを確認する。
統合結果の正確性、上書き制御、ロック処理、エラー処理が仕様どおりに行われることを確認する。

---

\## 2. 試験範囲

- MergeSheetsマクロの全機能
- 統合元フォルダの再帰処理
- 統合先ブック保存、日付フォルダ作成
- 統合結果「Results」シート出力
- 上書き制御、ロック制御、エラー処理

---

\## 3. 試験観点

| 観点ID | 試験観点 | 説明 |
|--------|-----------|------|
| TP01 | 統合先ブック存在確認 | 指定された統合先ブックが存在しない場合にエラーが発生するか |
| TP02 | 統合先ロック確認 | 統合先ブックが開かれている場合にエラーが発生するか |
| TP03 | シート上書き制御 | 同名シートが存在する場合にOverwrite設定が反映されるか |
| TP04 | 統合元フォルダ再帰 | サブフォルダ内のExcelシートも統合されるか |
| TP05 | 統合結果記録 | Resultsシートにシート名、状態、統合元パスが正しく記録されるか |
| TP06 | 保存先制御 | マージファイルが日付フォルダに正しく保存されるか |
| TP07 | 異常系処理 | 想定外エラーやファイルアクセス権限不足時に適切に処理されるか |

---

\## 4. 試験項目・手順・期待結果


| 試験ID | 試験項目 | 手順 | 期待結果 |
|---------|-----------|------|-----------|
| T001 | 統合先ブック存在確認 | 存在しないブックパスをB4に設定してマクロ実行 | エラーが表示され、処理中止 |
| T002 | 統合先ロック確認 | 統合先ブックを開いた状態でマクロ実行 | 「統合先ブックが開かれているか、ロックファイルが存在します。」エラー |
| T003 | 同名シート上書きOFF | 統合元に既存シート名と同名シートがある状態でOverwrite=FALSE実行 | 「統合中にシート名の重複が発生しました。」エラー |
| T004 | 同名シート上書きON | 同条件でOverwrite=TRUE実行 | 既存シートを削除して統合元シートをコピー、Resultsに「上書き」と記録 |
| T005 | 統合元フォルダ再帰処理 | サブフォルダにExcelファイルを配置、マクロ実行 | 全てのシートが統合され、Resultsシートに記録 |
| T006 | 統合結果記録 | マクロ実行後、Resultsシート確認 | シート名、状態（追加/上書き）、統合元パスが正確に記録されている |
| T007 | マージファイル保存 | マクロ実行後、日付フォルダ確認 | マージファイルが `\_merged\_yyyymmdd\_hhnnss.xlsx` 形式で保存されている |
| T008 | 非Excelファイル存在時 | 統合元フォルダに非Excelファイル配置 | 無視され、統合処理は正常に完了 |
| T009 | 想定外エラー | 読み取り専用・アクセス権限不足ファイル配置 | ERR\_UNEXPECTED が発生し、処理停止、マージファイル削除 |

---

\## 5. 試験環境

- Microsoft Excel 2016以降
- Windows 11
- テスト用統合元フォルダにExcelファイルを配置（複数ファイル、サブフォルダ含む）
- 統合先ブックはマクロ無効ブック（xlsx）で準備

---

\## 6. 判定基準

- 期待結果どおりに統合されること
- Resultsシートに全シート情報が正しく記録されること
- 上書き制御、ロック制御、エラー処理が仕様通りに動作すること

---

\## 7. 備考

- 処理時間は統合対象ファイル数に依存
- マクロ実行前に統合先ブックは閉じることを推奨
- 統合結果は日付フォルダに保存されるため、履歴確認可能
